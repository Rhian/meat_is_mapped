require 'rest-client'
require 'sqlite3'
require 'active_record'
require 'nokogiri'

DBCONN = ActiveRecord::Base.establish_connection({:adapter => "sqlite3", :database => '///home/user/RubyExamples/MeatMap/db/animal_data.sqlite3'})

for pgnum in 2..17 do
  @page = Nokogiri::HTML(open("Localfile#{pgnum}.html"))
    @page.css("div.addr, div.adr.h2").each do | div |
    div.css("a.fn").each do |names|
      @names = names.text
    end
    div.css(".street-address").each do |addresses|
      @addresses = addresses.text
    end
    div.css(".postal-code").each do |postcodes|
      @postcodes = postcodes.text.split(//).last(8).join.to_s
    end

	update = DBCONN.connection.raw_connection.prepare("INSERT INTO abbatoirs (name, address, postcode) VALUES(:name, :address, :postcode)")
	update.execute(:name => @names, :address => @addresses, :postcode => @postcodes)
	update.close

    end
end

